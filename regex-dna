#!/bin/bash
tail -n +3 "$0" | R --slave --args $@; exit $?
# ------------------------------------------------------------------
# The Computer Language Shootout
# http://shootout.alioth.debian.org/
#
# Contributed by Leo Osvald
# ------------------------------------------------------------------

pattern1 <- c(
    "agggtaaa|tttaccct",
    "[cgt]gggtaaa|tttaccc[acg]",
    "a[act]ggtaaa|tttacc[agt]t",
    "ag[act]gtaaa|tttac[agt]ct",
    "agg[act]taaa|ttta[agt]cct",
    "aggg[acg]aaa|ttt[cgt]ccct",
    "agggt[cgt]aa|tt[acg]accct",
    "agggta[cgt]a|t[acg]taccct",
    "agggtaa[cgt]|[acg]ttaccct")

pattern2 <- matrix(c(
        c("B", "(c|g|t)"),
        c("D", "(a|g|t)"),
        c("H", "(a|c|t)"),
        c("K", "(g|t)"),
        c("M", "(a|c)"),
        c("N", "(a|c|g|t)"),
        c("R", "(a|g)"),
        c("S", "(c|g)"),
        c("V", "(a|c|g)"),
        c("W", "(a|t)"), 
        c("Y", "(c|t)")
), ncol=2, byrow=TRUE)

match_count <- function(ms) {
    l <- length(ms[[1]])
    fst <- ms[[1]][[1]]
    return(ifelse(l > 1, l, ifelse(fst != -1L, fst, 0)))
}

f <- file("regex-dna.in.50000", "r")
str <- paste(c(readLines(f), ""), collapse="\n")
close(f)

len1 <- nchar(str)
str <- gsub(">.*\n|\n", "", str, perl=TRUE, useBytes=TRUE)
len2 <- nchar(str)

for (pat in pattern1)
    cat(pat, match_count(gregexpr(pat, str, useBytes=TRUE)), "\n")

for (i in 1:nrow(pattern2))
    str <- gsub(pattern2[[i, 1]], pattern2[[i, 2]], str, perl=TRUE, useBytes=TRUE)

cat("", len1, len2, nchar(str), sep="\n")
